CONFIG_FILE=inventory/mycluster/hosts.yaml python3.11 contrib/inventory_builder/inventory.py ${IPS[@]}
ansible -i inventory/mycluster/hosts.yaml all -m ping -u ubuntu --private-key=/home/fabryan/.ssh/id_ed25519 -e 'ansible_ssh_common_args="-o StrictHostKeyChecking=no"'
ansible-playbook -i inventory/mycluster/hosts.yaml -u ubuntu --private-key=/home/fabryan/.ssh/id_ed25519 -e 'ansible_ssh_common_args="-o StrictHostKeyChecking=no"' cluster.yml
/venv/bin/ansible-playbook -i inventory/mycluster/hosts.yaml -u ubuntu --become --become-user=root --private-key=/home/fabryan/.ssh/id_ed25519 -e 'ansible_ssh_common_args="-o StrictHostKeyChecking=no"' cluster.yml --flush-cache


device_name - (Optional) Name of the device representing the filesystem on the instance.
network_interface.0.ip_address - The internal IP address of the instance.

network_interface.0.nat_ip_address - The external IP address of the instance.


# resource "yandex_instance" "node1" {
#   provisioner "remote-exec" {
#     connection {
#       type        = "ssh"
#       user        = "ubuntu"
#       private_key = file("~/.ssh/id_ed25519")
#     }
#   }

#   provisioner "local-exec" {
#     command = "ansible -i ./ansible/kubespray/inventory/mycluster/hosts.yaml all -m ping -u ${var.user} --private-key=${var.ssh_key_private} -e 'ansible_ssh_common_args=\"-o StrictHostKeyChecking=no\"'"
#   }
# }

# resource "null_resource" "run_ansible" {
#   depends_on = [
#     yandex_compute_instance.master,  # Замените на соответствующие ресурсы
#     # Другие ресурсы, от которых зависит выполнение ансибла
#   ]
#   provisioner "local-exec" {
#     command = "ansible -i ./ansible/kubespray/inventory/mycluster/hosts.yaml all -m ping -u ubuntu --private-key=${local.ssh-private-keys} -e 'ansible_ssh_common_args=\"-o StrictHostKeyChecking=no\"'"
#   }
# }

  # provisioner "remote-exec" {
  #   inline = ["sudo ls -lah"]

  #   connection {
  #     type        = "ssh"
  #     user        = "ubuntu"
  #     private_key = local.ssh-private-keys
  #     # host        = self.network_interface[0].nat_ip_address
  #     host        = self.network_interface[0].nat_ip_address
  #   }
  # }

  # provisioner "local-exec" {
  #   # command = "ansible-playbook -u fedora -i '${self.public_ip},' --private-key ${var.ssh_key_private} provision.yml"
  #   command = "ansible -i ./ansible/kubespray/inventory/mycluster/hosts.yaml all -m ping -u ubuntu --private-key=${local.ssh-private-keys} -e 'ansible_ssh_common_args=\"-o StrictHostKeyChecking=no\"'"

  # }